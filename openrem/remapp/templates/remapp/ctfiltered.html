{% extends "remapp/filteredbase.html" %}

{% block navct%}<li class="active">{% endblock %}

{% block toprow %}

    <p>
        There are {{ filter.qs.count }} studies in this list.
    </p>

{% endblock %}

{% block col2 %}
    <div class="panel panel-info small">
        <div class="panel-heading">
            <h3 class="panel-title">Data export</h3>
        </div>
        <div class="panel-body">
            {% if admin.exportgroup %}
                <p><strong>Note:</strong> Apply the exam filter first to refine what is exported.</p>
                <p>
                    <a href="{% url 'ctcsv1' 0 0 %}?{{ request.GET.urlencode }}"
                       class="btn btn-default btn-sm" role="button">Export to CSV&nbsp;</a>
                    {% if admin.pidgroup %}
                        <a href="{%  url 'ctcsv1' 1 0 %}?{{ request.GET.urlencode }}"
                           class="btn btn-default btn-sm" role="button">With names</a>
                        <a href="{% url 'ctcsv1' 0 1 %}?{{ request.GET.urlencode }}"
                           class="btn btn-default btn-sm" role="button">With ID</a>
                        <a href="{% url 'ctcsv1' 1 1 %}?{{ request.GET.urlencode }}"
                           class="btn btn-default btn-sm" role="button">With both</a>
                        </p>
                        <p>
                    {% endif %}
                    <a href="{% url 'ctxlsx1' 0 0 %}?{{ request.GET.urlencode }}"
                       class="btn btn-default btn-sm" role="button">Export to XLSX</a>
                    {% if admin.pidgroup %}
                        <a href="{% url 'ctxlsx1' 1 0 %}?{{ request.GET.urlencode }}"
                           class="btn btn-default btn-sm" role="button">With names</a>
                        <a href="{% url 'ctxlsx1' 0 1 %}?{{ request.GET.urlencode }}"
                           class="btn btn-default btn-sm" role="button">With ID</a>
                        <a href="{% url 'ctxlsx1' 1 1 %}?{{ request.GET.urlencode }}"
                           class="btn btn-default btn-sm" role="button">With both</a>
                    {% endif %}
                    </p>
              <p>
                  <a href="{% url 'ct_xlsx_phe2019' %}?{{ request.GET.urlencode }}"
                     class="btn btn-default btn-sm" role="button">PHE 2019 survey</a>
              </p>

            {% else %}
                <p>
                    No export permissions
                </p>
            {% endif %}


        </div>
    </div>

    {{ studyfilter }}

    <form action="" method="get" class="form-horizontal" role="form">
        <div class="panel panel-info small">
            <div class="panel-heading">
                <h3 class="panel-title">Exam filter</h3>
            </div>
            <div class="panel-body">
                <i>Date format yyyy-mm-dd</i>
                {% for field in filter.form.visible_fields %}
                    <div class="form-group">
                        <div class="col-xs-4">
                            <label>{{ field.label_tag }}</label>
                        </div>
                        <div class="col-xs-8">
                            {{ field.errors }}
                            {{ field }}
                        </div>
                    </div>
                {% endfor %}
                {% for field in filter.form.hidden_fields %}
                    <div style="display:none">{{ field }}</div>
                {% endfor %}
                <input class="btn btn-default" name="submit" type="submit" />
            </div>
            <div class="panel-heading">
                <h3 class="panel-title">Chart options</h3>
            </div>
            <div class="panel-body">
                <table>
                    {% csrf_token %}
                    {{ chartOptionsForm }}
                </table>
                <input class="btn btn-default" name="submit" type="submit" />
            </div>
            <div class="panel-heading">
                <h3 class="panel-title">Table options</h3>
            </div>
            <div class="panel-body">
                <table>
                    {{ itemsPerPageForm }}
                </table>
                <input class="btn btn-default" name="submit" type="submit" />
            </div>
        </div>
    </form>

    <script src="{{ STATIC_URL }}js/datepicker.js"></script>
    <script src="{{ STATIC_URL }}js/formatDate.js"></script>

{% endblock %}

{% block col1 %}


    <table class="table table-bordered table-hover row-clickable small">
        <tr>
            <th>Institution</th>
            <th>
                <table>
                    <tr><td>Make</td></tr>
                    <tr><td>Model</td></tr>
                    <tr><td class="nowrap">Display name</td></tr>
                </table>
            </th>
            <th>Date</th>
            <th>
                <table>
                    <tr><td class="nowrap">Study description</td></tr>
                    <tr><td class="nowrap">Procedure</td></tr>
                    <tr><td class="nowrap">Requested Procedure</td></tr>
                    <tr><td class="nowrap">Accession number</td></tr>
                </table>
            </th>
            <th>Number of events</th>
            <th>Total DLP (mGy.cm)</th>
            {% if admin.admingroup %}
                <th>Delete?</th>
            {% endif %}
        </tr>
        {% for exam in study_list %}
          {% with equipment=exam.generalequipmentmoduleattr_set.get %}
            <tr>
                <td>
                    <a href="{% url 'ct_detail_view' pk=exam.id %}">
                        {{ equipment.institution_name }}
                    </a>
                </td>
                <td>
                    <a href="{% url 'ct_detail_view' pk=exam.id %}">
                        <table onclick="window.location='{% url 'ct_detail_view' pk=exam.id %}';">
                            <tr><td class="nowrap">{{ equipment.manufacturer }}</td></tr>
                            <tr><td class="nowrap">{{ equipment.manufacturer_model_name }}</td></tr>
                            <tr><td class="nowrap">{{ equipment.unique_equipment_name.display_name }}</td></tr>
                        </table>
                    </a>
                </td>
                <td>
                    <a href="{% url 'ct_detail_view' pk=exam.id %}">
                        {{ exam.study_date|date:"Y-m-d" }} {{ exam.study_time|date:"H:i" }}</td>
                </a>
                <td>
                    <a href="{% url 'ct_detail_view' pk=exam.id %}">
                        <table onclick="window.location='{% url 'ct_detail_view' pk=exam.id %}';">
                            <tr><td class="nowrap">{{ exam.study_description }}</td></tr>
                            <tr><td class="nowrap">{{ exam.procedure_code_meaning }}</td></tr>
                            <tr><td class="nowrap">{{ exam.requested_procedure_code_meaning }}</td></tr>
                            {% if not exam.accession_hashed %}
                                <tr><td class="nowrap">{{ exam.accession_number }}</td></tr>
                            {% endif %}
                        </table>
                    </a>
                </td>
                <td>
                    <a href="{% url 'ct_detail_view' pk=exam.id %}">
                        {{ exam.number_of_events }}
                    </a>
                </td>
                <td>
                    <a href="{% url 'ct_detail_view' pk=exam.id %}">
                        {{ exam.total_dlp|floatformat:2 }}
                    </a>
                </td>
                {% if admin.admingroup %}
                    <td>
                        <a href="{% url 'study_delete' exam.id %}">Delete</a>
                    </td>
                {% endif %}
            </tr>
          {% endwith %}
        {% endfor %}
    </table>


{% endblock %}

{% block jsblock %}
{% endblock %}

{% block plotdata %}

    {% if request.user.userprofile.plotCharts %}

        <script src="{{ STATIC_URL }}js/django_reverse/reverse.js"></script>
        <script src="{{ STATIC_URL }}js/chroma.min.js"></script>

        <div class="ajax-progress"><img src="{{ STATIC_URL }}img/ajax-loader.gif"></div>

        <!-- JavaScript to enable Altair charts -->
        <script src="{{ STATIC_URL }}js/charts/vega@5.js"></script>
        <script src="{{ STATIC_URL }}js/charts/vega-lite@4.js"></script>
        <script src="{{ STATIC_URL }}js/charts/vega-embed@6.js"></script>
        <!-- End of JavaScript to enable Altair charts -->

        <!-- JavaScript to enable Plotly charts -->
        <script src="{{ STATIC_URL }}js/charts/plotly-latest.min.js"></script>
        <!-- End of JavaScript to enable Plotly charts -->

        <!-- JavaScript Plotly chart resizing code. -->
        <script src="{{ STATIC_URL }}js/charts/chartFullScreen.js"></script>
        <!-- End of JavaScript Plotly chart resizing code. -->

        <!-- JavaScript chart AJAX code. -->
        <script src="{{ STATIC_URL }}js/charts/ctChartAjax.js"></script>
        <!-- End of JavaScript chart AJAX code. -->

        {% if request.user.userprofile.plotCTAcquisitionMeanDLP %}
            <!-- HTML to include div container for acquisition plot -->
            <div class="panel-group" id="accordion2">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <a data-toggle="collapse" data-parent="#accordion2" href="#collapseAcquisitionAveDLP" onclick="setTimeout(function() {triggerResizeEvent();}, 0);">
                                {% if request.user.userprofile.plotAverageChoice == 'mean' %}
                                    Chart of mean DLP for each acquisition protocol
                                {% elif request.user.userprofile.plotAverageChoice == 'median' %}
                                    Chart of median DLP for each acquisition protocol
                                {% else %}
                                    Charts of mean and median DLP for each acquisition protocol
                                {% endif %}
                            </a>
                        </h4>
                    </div>
                    <div id="collapseAcquisitionAveDLP" class="panel-collapse collapse">
                        {% if request.user.userprofile.plotAverageChoice in 'mean both' %}
                        <div id="acquisitionMeanDLPChartParentDiv" class="panel-body">
                            <div id="acquisitionMeanDLPChartDiv"></div>
                            <a onclick="enterFullScreenPlotly('acquisitionMeanDLPChartDiv', 'acquisitionMeanDLPChartParentDiv');"
                               class="btn btn-default btn-sm" role="button">Toggle fullscreen</a>
                        </div>
                        {% endif %}
                        {% if request.user.userprofile.plotAverageChoice in 'median both' %}
                        <div id="acquisitionMedianDLPChartParentDiv" class="panel-body">
                            <div id="acquisitionMedianDLPChartDiv"></div>
                            <a onclick="enterFullScreenPlotly('acquisitionMedianDLPChartDiv', 'acquisitionMedianDLPChartParentDiv');"
                               class="btn btn-default btn-sm" role="button">Toggle fullscreen</a>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            <!-- End of HTML to include div container for acquisition DLP plot -->

            {% if request.user.userprofile.plotHistograms %}
                <!-- HTML to include div container for acquisition DLP histograms -->
                <div class="panel-group" id="acquisitionHistogramDLPDiv">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#acquisitionHistogramDLPDiv" href="#collapseAcquisitionHistogramDLP" onclick="setTimeout(function() {triggerResizeEvent();}, 0);">
                                    Histograms of DLP for each acquisition protocol
                                </a>
                            </h4>
                        </div>
                        <div id="collapseAcquisitionHistogramDLP" class="panel-collapse collapse">
                            <div id="acquisitionHistogramDLPChartParentDiv" class="panel-body">
                                <div id="acquisitionHistogramDLPChartDiv"></div>
                                <a onclick="enterFullScreenPlotly('acquisitionHistogramDLPChartDiv', 'acquisitionHistogramDLPChartParentDiv');"
                                   class="btn btn-default btn-sm" role="button">Toggle fullscreen</a>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- End of HTML to include div container for acquisition DLP histograms -->
            {% endif %}
        {% endif %}

        {% if request.user.userprofile.plotCTAcquisitionMeanCTDI %}
            <!-- HTML to include div container for acquisition CTDI plot -->
            <div class="panel-group" id="accordion3">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <a data-toggle="collapse" data-parent="#accordion3" href="#collapseAcquisitionAveCTDI" onclick="setTimeout(function() {triggerResizeEvent();}, 0);">
                                {% if request.user.userprofile.plotAverageChoice == 'mean' %}
                                    Chart of mean CTDI<sub>vol</sub> for each acquisition protocol
                                {% elif request.user.userprofile.plotAverageChoice == 'median' %}
                                    Chart of median CTDI<sub>vol</sub> for each acquisition protocol
                                {% else %}
                                    Charts of mean and median CTDI<sub>vol</sub> for each acquisition protocol
                                {% endif %}
                            </a>
                        </h4>
                    </div>
                    <div id="collapseAcquisitionAveCTDI" class="panel-collapse collapse">
                        {% if request.user.userprofile.plotAverageChoice in 'mean both' %}
                        <div id="acquisitionMeanCTDIChartParentDiv" class="panel-body">
                            <div id="acquisitionMeanCTDIChartDiv"></div>
                            <a onclick="enterFullScreenPlotly('acquisitionMeanCTDIChartDiv', 'acquisitionMeanCTDIChartParentDiv');"
                               class="btn btn-default btn-sm" role="button">Toggle fullscreen</a>
                        </div>
                        {% endif %}
                        {% if request.user.userprofile.plotAverageChoice in 'median both' %}
                        <div id="acquisitionMedianCTDIChartParentDiv" class="panel-body">
                            <div id="acquisitionMedianCTDIChartDiv"></div>
                            <a onclick="enterFullScreenPlotly('acquisitionMedianCTDIChartDiv', 'acquisitionMedianCTDIChartParentDiv');"
                               class="btn btn-default btn-sm" role="button">Toggle fullscreen</a>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            <!-- End of HTML to include div container for acquisition CTDI plot -->

            {% if request.user.userprofile.plotHistograms %}
                <!-- HTML to include div container for acquisition CTDI histograms -->
                <div class="panel-group" id="acquisitionHistogramCTDIDiv">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#acquisitionHistogramCTDIDiv" href="#collapseAcquisitionHistogramCTDI" onclick="setTimeout(function() {triggerResizeEvent();}, 0);">
                                    Histograms of CTDI<sub>vol</sub> for each acquisition protocol
                                </a>
                            </h4>
                        </div>
                        <div id="collapseAcquisitionHistogramCTDI" class="panel-collapse collapse">
                            <div id="acquisitionHistogramCTDIChartParentDiv" class="panel-body">
                                <div id="acquisitionHistogramCTDIChartDiv"></div>
                                <a onclick="enterFullScreenPlotly('acquisitionHistogramCTDIChartDiv', 'acquisitionHistogramCTDIChartParentDiv');"
                                   class="btn btn-default btn-sm" role="button">Toggle fullscreen</a>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- End of HTML to include div container for acquisition CTDI histograms -->
            {% endif %}
        {% endif %}

        {% if request.user.userprofile.plotCTAcquisitionFreq %}
            <!-- HTML to include div container for acquisition frequency chart -->
            <div class="panel-group" id="accordion4">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <a data-toggle="collapse" data-parent="#accordion4" href="#collapseProtocolFreqChart" onclick="setTimeout(function() {triggerResizeEvent();}, 0);">
                                Chart of acquisition protocol frequency
                            </a>
                        </h4>
                    </div>
                    <div id="collapseProtocolFreqChart" class="panel-collapse collapse">
                        <div id="acquisitionFreqChartParentDiv" class="panel-body">
                            <div id="acquisitionFreqChartDiv"></div>
                            <a onclick="enterFullScreenPlotly('acquisitionFreqChartDiv', 'acquisitionFreqChartParentDiv');"
                               class="btn btn-default btn-sm" role="button">Toggle fullscreen</a>
                        </div>
                    </div>
                </div>
            </div>
            <!-- HTML to include div container for acquisition frequency chart -->
        {% endif %}

        {% if request.user.userprofile.plotCTAcquisitionCTDIvsMass %}
            <!-- HTML to include div container for acquisition CTDI vs patient mass chart -->
            <div class="panel-group" id="acquisitionScatterCTDIvsMass">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <a data-toggle="collapse" data-parent="#acquisitionScatterCTDIvsMass" href="#collapseAcquisitionScatterCTDIvsMass" onclick="setTimeout(function() {triggerResizeEvent();}, 0);">
                                Charts of CTDI vs patient mass
                            </a>
                        </h4>
                    </div>
                    <div id="collapseAcquisitionScatterCTDIvsMass" class="panel-collapse collapse">
                        <div id="acquisitionScatterCTDIvsMassChartParentDiv" class="panel-body">
                            <div id="acquisitionScatterCTDIvsMassChartDiv"></div>
                            <a onclick="enterFullScreenPlotly('acquisitionScatterCTDIvsMassChartDiv', 'acquisitionScatterCTDIvsMassChartParentDiv');"
                               class="btn btn-default btn-sm" role="button">Toggle fullscreen</a>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End of HTML to include div container for acquisition CTDI vs patient mass chart -->
        {% endif %}

        {% if request.user.userprofile.plotCTAcquisitionDLPvsMass %}
            <!-- HTML to include div container for acquisition DLP vs patient mass chart -->
            <div class="panel-group" id="acquisitionScatterDLPvsMass">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <a data-toggle="collapse" data-parent="#acquisitionScatterDLPvsMass" href="#collapseAcquisitionScatterDLPvsMass" onclick="setTimeout(function() {triggerResizeEvent();}, 0);">
                                Charts of DLP vs patient mass
                            </a>
                        </h4>
                    </div>
                    <div id="collapseAcquisitionScatterDLPvsMass" class="panel-collapse collapse">
                        <div id="acquisitionScatterDLPvsMassChartParentDiv" class="panel-body">
                            <div id="acquisitionScatterDLPvsMassChartDiv"></div>
                            <a onclick="enterFullScreenPlotly('acquisitionScatterDLPvsMassChartDiv', 'acquisitionScatterDLPvsMassChartParentDiv');"
                               class="btn btn-default btn-sm" role="button">Toggle fullscreen</a>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End of HTML to include div container for acquisition DLP vs patient mass chart -->
        {% endif %}

        {% if request.user.userprofile.plotCTStudyMeanDLP %}
            <!-- HTML to include div container for study plot -->
            <div class="panel-group" id="accordion5">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <a data-toggle="collapse" data-parent="#accordion5" href="#collapseStudyAveDLP" onclick="setTimeout(function() {triggerResizeEvent();}, 0);">
                                {% if request.user.userprofile.plotAverageChoice == 'mean' %}
                                    Chart of mean DLP for each study description
                                {% elif request.user.userprofile.plotAverageChoice == 'median' %}
                                    Chart of median DLP for each study description
                                {% else %}
                                    Charts of mean and median DLP for each study description
                                {% endif %}
                            </a>
                        </h4>
                    </div>
                    <div id="collapseStudyAveDLP" class="panel-collapse collapse">
                        {% if request.user.userprofile.plotAverageChoice in 'mean both' %}
                        <div id="studyMeanDLPChartParentDiv" class="panel-body">
                            <div id="studyMeanDLPChartDiv"></div>
                            <a onclick="enterFullScreenPlotly('studyMeanDLPChartDiv', 'studyMeanDLPChartParentDiv');"
                               class="btn btn-default btn-sm" role="button">Toggle fullscreen</a>
                        </div>
                        {% endif %}
                        {% if request.user.userprofile.plotAverageChoice in 'median both' %}
                        <div id="studyMedianDLPChartParentDiv" class="panel-body">
                            <div id="studyMedianDLPChartDiv"></div>
                            <a onclick="enterFullScreenPlotly('studyMedianDLPChartDiv', 'studyMedianDLPChartParentDiv');"
                               class="btn btn-default btn-sm" role="button">Toggle fullscreen</a>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            <!-- End of HTML to include div container for study plot -->

            {% if request.user.userprofile.plotHistograms %}
                <!-- HTML to include div container for study DLP histograms -->
                <div class="panel-group" id="studyHistogramDLPDiv">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#studyHistogramDLPDiv" href="#collapseStudyHistogramDLP" onclick="setTimeout(function() {triggerResizeEvent();}, 0);">
                                    Histograms of DLP for each study description
                                </a>
                            </h4>
                        </div>
                        <div id="collapseStudyHistogramDLP" class="panel-collapse collapse">
                            <div id="studyHistogramDLPChartParentDiv" class="panel-body">
                                <div id="studyHistogramDLPChartDiv"></div>
                                <a onclick="enterFullScreenPlotly('studyHistogramDLPChartDiv', 'studyHistogramDLPChartParentDiv');"
                                   class="btn btn-default btn-sm" role="button">Toggle fullscreen</a>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- End of HTML to include div container for study description DLP histograms -->
            {% endif %}
        {% endif %}

        {% if request.user.userprofile.plotCTStudyMeanCTDI %}
            <!-- HTML to include div container for study CTDI plot -->
            <div class="panel-group" id="accordionStudyCTDI">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <a data-toggle="collapse" data-parent="#accordionStudyCTDI" href="#collapseStudyAveCTDI" onclick="setTimeout(function() {triggerResizeEvent();}, 0);">
                                {% if request.user.userprofile.plotAverageChoice == 'mean' %}
                                    Chart of mean CTDI<sub>vol</sub> for each study description (may include multiple acquisition protocols per study).
                                {% elif request.user.userprofile.plotAverageChoice == 'median' %}
                                    Chart of median CTDI<sub>vol</sub> for each study description (may include multiple acquisition protocols per study).
                                {% else %}
                                    Charts of mean and median CTDI<sub>vol</sub> for each study description (may include multiple acquisition protocols per study).
                                {% endif %}
                            </a>
                        </h4>
                    </div>
                    <div id="collapseStudyAveCTDI" class="panel-collapse collapse">
                        {% if request.user.userprofile.plotAverageChoice in 'mean both' %}
                        <div id="studyMeanCTDIChartParentDiv" class="panel-body">
                            <div id="studyMeanCTDIChartDiv"></div>
                            <a onclick="enterFullScreenPlotly('studyMeanCTDIChartDiv', 'studyMeanCTDIChartParentDiv');"
                               class="btn btn-default btn-sm" role="button">Toggle fullscreen</a>
                        </div>
                        {% endif %}
                        {% if request.user.userprofile.plotAverageChoice in 'median both' %}
                        <div id="studyMedianCTDIChartParentDiv" class="panel-body">
                            <div id="studyMedianCTDIChartDiv"></div>
                            <a onclick="enterFullScreenPlotly('studyMedianCTDIChartDiv', 'studyMedianCTDIChartParentDiv');"
                               class="btn btn-default btn-sm" role="button">Toggle fullscreen</a>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            <!-- End of HTML to include div container for study CTDI plot -->

            {% if request.user.userprofile.plotHistograms %}
                <!-- HTML to include div container for study CTDI histograms -->
                <div class="panel-group" id="studyHistogramCTDIDiv">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#studyHistogramCTDIDiv" href="#collapseStudyHistogramCTDI" onclick="setTimeout(function() {triggerResizeEvent();}, 0);">
                                    Histograms of CTDI for each study description
                                </a>
                            </h4>
                        </div>
                        <div id="collapseStudyHistogramCTDI" class="panel-collapse collapse">
                            <div id="studyHistogramCTDIChartParentDiv" class="panel-body">
                                <div id="studyHistogramCTDIChartDiv"></div>
                                <a onclick="enterFullScreenPlotly('studyHistogramCTDIChartDiv', 'studyHistogramCTDIChartParentDiv');"
                                   class="btn btn-default btn-sm" role="button">Toggle fullscreen</a>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- End of HTML to include div container for study description CTDI histograms -->
            {% endif %}
        {% endif %}

        {% if request.user.userprofile.plotCTStudyFreq %}
            <!-- HTML to include div container for study frequency chart -->
            <div class="panel-group" id="accordion6">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <a data-toggle="collapse" data-parent="#accordion6" href="#collapseStudyFreqChart" onclick="setTimeout(function() {triggerResizeEvent();}, 0);">
                                Charts of study description frequency
                            </a>
                        </h4>
                    </div>
                    <div id="collapseStudyFreqChart" class="panel-collapse collapse">
                        <div id="studyFreqChartParentDiv" class="panel-body">
                            <div id="studyFreqChartDiv"></div>
                            <a onclick="enterFullScreenPlotly('studyFreqChartDiv', 'studyFreqChartParentDiv');"
                               class="btn btn-default btn-sm" role="button">Toggle fullscreen</a>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End of HTML to include div container for study pie chart -->
        {% endif %}

        {% if request.user.userprofile.plotCTStudyNumEvents %}
            <!-- HTML to include div container for study plot -->
            <div class="panel-group" id="accordion11">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <a data-toggle="collapse" data-parent="#accordion11" href="#collapseStudyNumEvents" onclick="setTimeout(function() {triggerResizeEvent();}, 0);">
                                {% if request.user.userprofile.plotAverageChoice == 'mean' %}
                                    Chart of mean number of events for each study description
                                {% elif request.user.userprofile.plotAverageChoice == 'median' %}
                                    Chart of median number of events for each study description
                                {% else %}
                                    Charts of mean and median number of events for each study description
                                {% endif %}
                            </a>
                        </h4>
                    </div>
                    <div id="collapseStudyNumEvents" class="panel-collapse collapse">
                        {% if request.user.userprofile.plotAverageChoice in 'mean both' %}
                        <div id="studyMeanNumEventsChartParentDiv" class="panel-body">
                            <div id="studyMeanNumEventsChartDiv"></div>
                            <a onclick="enterFullScreenPlotly('studyMeanNumEventsChartDiv', 'studyMeanNumEventsChartParentDiv');"
                               class="btn btn-default btn-sm" role="button">Toggle fullscreen</a>
                        </div>
                        {% endif %}
                        {% if request.user.userprofile.plotAverageChoice in 'median both' %}
                        <div id="studyMedianNumEventsChartParentDiv" class="panel-body">
                            <div id="studyMedianNumEventsChartDiv"></div>
                            <a onclick="enterFullScreenPlotly('studyMedianNumEventsChartDiv', 'studyMedianNumEventsChartParentDiv');"
                               class="btn btn-default btn-sm" role="button">Toggle fullscreen</a>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            <!-- End of HTML to include div container for study plot -->

            {% if request.user.userprofile.plotHistograms %}
                <!-- HTML to include div container for study num events histograms -->
                <div class="panel-group" id="studyHistogramNumEventsDiv">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#studyHistogramNumEventsDiv" href="#collapseStudyHistogramNumEvents" onclick="setTimeout(function() {triggerResizeEvent();}, 0);">
                                    Histograms of number of events for each study description
                                </a>
                            </h4>
                        </div>
                        <div id="collapseStudyHistogramNumEvents" class="panel-collapse collapse">
                            <div id="studyHistogramNumEventsChartParentDiv" class="panel-body">
                                <div id="studyHistogramNumEventsChartDiv"></div>
                                <a onclick="enterFullScreenPlotly('studyHistogramNumEventsChartDiv', 'studyHistogramNumEventsChartParentDiv');"
                                   class="btn btn-default btn-sm" role="button">Toggle fullscreen</a>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- End of HTML to include div container for study num events histograms -->
            {% endif %}
        {% endif %}

        {% if request.user.userprofile.plotCTRequestMeanDLP %}
            <!-- HTML to include div container for request plot -->
            <div class="panel-group" id="accordion7">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <a data-toggle="collapse" data-parent="#accordion7" href="#collapseRequestAveDLP" onclick="setTimeout(function() {triggerResizeEvent();}, 0);">
                                {% if request.user.userprofile.plotAverageChoice == 'mean' %}
                                    Chart of mean DLP for each requested procedure
                                {% elif request.user.userprofile.plotAverageChoice == 'median' %}
                                    Chart of median DLP for each requested procedure
                                {% else %}
                                    Charts of mean and median DLP for each requested procedure
                                {% endif %}
                            </a>
                        </h4>
                    </div>
                    <div id="collapseRequestAveDLP" class="panel-collapse collapse">
                        {% if request.user.userprofile.plotAverageChoice in 'mean both' %}
                        <div id="requestMeanDLPChartParentDiv" class="panel-body">
                            <div id="requestMeanDLPChartDiv"></div>
                            <a onclick="enterFullScreenPlotly('requestMeanDLPChartDiv', 'requestMeanDLPChartParentDiv');"
                               class="btn btn-default btn-sm" role="button">Toggle fullscreen</a>
                        </div>
                        {% endif %}
                        {% if request.user.userprofile.plotAverageChoice in 'median both' %}
                        <div id="requestMedianDLPChartParentDiv" class="panel-body">
                            <div id="requestMedianDLPChartDiv"></div>
                            <a onclick="enterFullScreenPlotly('requestMedianDLPChartDiv', 'requestMedianDLPChartParentDiv');"
                               class="btn btn-default btn-sm" role="button">Toggle fullscreen</a>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            <!-- End of HTML to include div container for request plot -->

            {% if request.user.userprofile.plotHistograms %}
                <!-- HTML to include div container for request histograms -->
                <div class="panel-group" id="requestHistogramDiv">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#requestHistogramDiv" href="#collapseRequestHistogramDLP" onclick="setTimeout(function() {triggerResizeEvent();}, 0);">
                                    Histograms of DLP for each requested procedure
                                </a>
                            </h4>
                        </div>
                        <div id="collapseRequestHistogramDLP" class="panel-collapse collapse">
                            <div id="requestHistogramDLPChartParentDiv" class="panel-body">
                                <div id="requestHistogramDLPChartDiv"></div>
                                <a onclick="enterFullScreenPlotly('requestHistogramDLPChartDiv', 'requestHistogramDLPChartParentDiv');"
                                   class="btn btn-default btn-sm" role="button">Toggle fullscreen</a>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- End of HTML to include div container for request histograms -->
            {% endif %}
        {% endif %}

        {% if request.user.userprofile.plotCTRequestFreq %}
            <!-- HTML to include div container for request frequency chart -->
            <div class="panel-group" id="accordion8">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <a data-toggle="collapse" data-parent="#accordion8" href="#collapseRequestFreqChart" onclick="setTimeout(function() {triggerResizeEvent();}, 0);">
                                Chart of requested procedure frequency
                            </a>
                        </h4>
                    </div>
                    <div id="collapseRequestFreqChart" class="panel-collapse collapse">
                        <div id="requestFreqChartParentDiv" class="panel-body">
                            <div id="requestFreqChartDiv"></div>
                            <a onclick="enterFullScreenPlotly('requestFreqChartDiv', 'requestFreqChartParentDiv');"
                               class="btn btn-default btn-sm" role="button">Toggle fullscreen</a>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End of HTML to include div container for request pie chart -->
        {% endif %}

        {% if request.user.userprofile.plotCTRequestNumEvents %}
            <!-- HTML to include div container for request plot -->
            <div class="panel-group" id="accordionRequestNumEvents">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <a data-toggle="collapse" data-parent="#accordionRequestNumEvents" href="#collapseRequestNumEvents" onclick="setTimeout(function() {triggerResizeEvent();}, 0);">
                                {% if request.user.userprofile.plotAverageChoice == 'mean' %}
                                    Chart of mean number of events for each requested procedure type
                                {% elif request.user.userprofile.plotAverageChoice == 'median' %}
                                    Chart of median number of events for each requested procedure type
                                {% else %}
                                    Charts of mean and median number of events for each requested procedure type
                                {% endif %}
                            </a>
                        </h4>
                    </div>
                    <div id="collapseRequestNumEvents" class="panel-collapse collapse">
                        {% if request.user.userprofile.plotAverageChoice in 'mean both' %}
                        <div id="requestMeanNumEventsChartParentDiv" class="panel-body">
                            <div id="requestMeanNumEventsChartDiv"></div>
                            <a onclick="enterFullScreenPlotly('requestMeanNumEventsChartDiv', 'requestMeanNumEventsChartParentDiv');"
                               class="btn btn-default btn-sm" role="button">Toggle fullscreen</a>
                        </div>
                        {% endif %}
                        {% if request.user.userprofile.plotAverageChoice in 'median both' %}
                        <div id="requestMedianNumEventsChartParentDiv" class="panel-body">
                            <div id="requestMedianNumEventsChartDiv"></div>
                            <a onclick="enterFullScreenPlotly('requestMedianNumEventsChartDiv', 'requestMedianNumEventsChartParentDiv');"
                               class="btn btn-default btn-sm" role="button">Toggle fullscreen</a>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            <!-- End of HTML to include div container for request plot -->

            {% if request.user.userprofile.plotHistograms %}
                <!-- HTML to include div container for request num events histograms -->
                <div class="panel-group" id="requestNumEventsHistogramDiv">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#requestNumEventsHistogramDiv" href="#collapseRequestHistogramNumEvents" onclick="setTimeout(function() {triggerResizeEvent();}, 0);">
                                    Histograms of number of events for each requested procedure
                                </a>
                            </h4>
                        </div>
                        <div id="collapseRequestHistogramNumEvents" class="panel-collapse collapse">
                            <div id="requestHistogramNumEventsChartParentDiv" class="panel-body">
                                <div id="requestHistogramNumEventsChartDiv"></div>
                                <a onclick="enterFullScreenPlotly('requestHistogramNumEventsChartDiv', 'requestHistogramNumEventsChartParentDiv');"
                                   class="btn btn-default btn-sm" role="button">Toggle fullscreen</a>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- End of HTML to include div container for request num events histograms -->
            {% endif %}
        {% endif %}

        {% if request.user.userprofile.plotCTStudyPerDayAndHour %}
            <!-- HTML to include div container for pie chart of studies per week day pie chart -->
            <div class="panel-group" id="accordion9">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <a data-toggle="collapse" data-parent="#accordion9" href="#collapseStudyWorkload" onclick="setTimeout(function() {triggerResizeEvent();}, 0);">
                                Charts of study workload.
                            </a>
                        </h4>
                    </div>
                    <div id="collapseStudyWorkload" class="panel-collapse collapse">
                        <div id="studyWorkloadChartParentDiv" class="panel-body">
                            <div id="studyWorkloadChartDiv"></div>
                            <a onclick="enterFullScreenPlotly('studyWorkloadChartDiv', 'studyWorkloadChartParentDiv');"
                               class="btn btn-default btn-sm" role="button">Toggle fullscreen</a>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End of HTML to include div container for studies per week day pie chart -->
        {% endif %}

        {% if request.user.userprofile.plotCTStudyMeanDLPOverTime %}
            <!-- HTML to include div container for mean study DLP per week -->
            <div class="panel-group" id="accordion10">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <a data-toggle="collapse" data-parent="#accordion10" href="#collapseWeeklyStudyMeanChart" onclick="setTimeout(function() {triggerResizeEvent();}, 0);">
                                {% if request.user.userprofile.plotAverageChoice == 'mean' %}
                                    Chart of mean DLP of each study type over time ({{ request.user.userprofile.plotCTStudyMeanDLPOverTimePeriod }})
                                {% elif request.user.userprofile.plotAverageChoice == 'median' %}
                                    Chart of median DLP of each study type over time ({{ request.user.userprofile.plotCTStudyMeanDLPOverTimePeriod }})
                                {% else %}
                                    Charts of mean and median DLP of each study type over time ({{ request.user.userprofile.plotCTStudyMeanDLPOverTimePeriod }})
                                {% endif %}
                            </a>
                        </h4>
                    </div>
                    <div id="collapseWeeklyStudyMeanChart" class="panel-collapse collapse">
                        {% if request.user.userprofile.plotAverageChoice in 'mean both' %}
                        <div id="studyMeanDLPOverTimeChartParentDiv" class="panel-body">
                            <div id="studyMeanDLPOverTimeChartDiv"></div>
                            <a onclick="enterFullScreenPlotly('studyMeanDLPOverTimeChartDiv', 'studyMeanDLPOverTimeChartParentDiv');"
                               class="btn btn-default btn-sm" role="button">Toggle fullscreen</a>
                        </div>
                        {% endif %}
                        {% if request.user.userprofile.plotAverageChoice in 'median both' %}
                        <div id="studyMedianDLPOverTimeChartParentDiv" class="panel-body">
                            <div id="studyMedianDLPOverTimeChartDiv"></div>
                            <a onclick="enterFullScreenPlotly('studyMedianDLPOverTimeChartDiv', 'studyMedianDLPOverTimeChartParentDiv');"
                               class="btn btn-default btn-sm" role="button">Toggle fullscreen</a>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            <!-- End of HTML to include div container for mean study DLP per week -->
        {% endif %}
    {% endif %}
{% endblock %}
